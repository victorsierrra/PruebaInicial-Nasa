<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa interactivo con iconos personalizados para incendios, glaciares, volcanes y tormentas severas</title>
    
    <!-- Incluye el CSS de Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />

    <link rel="stylesheet" href="../CSS/mapa.css" />


    <!-- Incluye el JS de Leaflet -->
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <style>
        /* Asegúrate de darle tamaño al contenedor del mapa */
        #map {
            height: 100vh;
            width: 100%;
        }
    </style>
</head>
<body>

    <div class="menu">
        <!-- Cabecera del menú -->
        <div class="menu-header" onclick="toggleMenu()">
            <div>
                <i class="fas fa-rocket"></i> Proyectos
            </div>
            <i class="fas fa-chevron-down"></i>
        </div>

        <!-- Sub-elementos del menú -->
        <div class="menu-items" id="menuItems">
            <div class="menu-item" id="primero">
                Sub Elemento #1 <span class="bullet">•</span>
            </div>
            <div class="menu-item" id="segundo">
                Sub Elemento #2 <span class="bullet">•</span>
            </div>
            <div class="menu-item" id="tercero">
                Sub Elemento #3 <span class="bullet">•</span>
            </div>
        </div>
    </div>


    <!-- Contenedor para el mapa -->
    <div id="map"></div>


    <script>
        // Función para desplegar o cerrar el menú
        function toggleMenu() {
            var menuItems = document.getElementById("menuItems");
            if (menuItems.style.display === "none" || menuItems.style.display === "") {
                menuItems.style.display = "flex";
            } else {
                menuItems.style.display = "none";
            }
        }
        
        // Inicializa el mapa
        var map = L.map('map').setView([20, 0], 2); // Coordenadas iniciales

        // Agrega una capa de mapa de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Definir el icono personalizado para glaciares
        var seaLakeIceIcon = L.icon({
            iconUrl: 'https://cdn.prod.website-files.com/625843c6d847c8dca08551d1/642d4476e3a49459e0408053_zyro-image%20(2)%201.png',
            iconSize: [52, 57],
            iconAnchor: [16, 37],
            popupAnchor: [0, -37]
        });

        // Definir el icono personalizado para incendios
        var fireIcon = L.icon({
            iconUrl: 'https://static.vecteezy.com/system/resources/thumbnails/017/744/774/small_2x/fire-and-flames-design-element-png.png',
            iconSize: [22, 27],
            iconAnchor: [16, 37],
            popupAnchor: [0, -37]
        });

        // Definir el icono personalizado para volcanes
        var volcanoIcon = L.icon({
            iconUrl: 'https://cdn-icons-png.flaticon.com/512/1808/1808385.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        // Definir el icono personalizado para tormentas severas
        var stormIcon = L.icon({
            iconUrl: 'https://cdn-icons-png.flaticon.com/512/252/252035.png', // URL del icono para tormentas
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        // Función para agregar un marcador de incendio al mapa con el icono personalizado
        function addWildfireMarker(coords, title) {
            L.marker(coords, { icon: fireIcon }).addTo(map)
                .bindPopup(`<strong>${title}</strong>`);
        }

        // Función para agregar un marcador de glaciares (Sea and Lake Ice) al mapa con el icono personalizado
        function addSeaLakeIceMarker(coords, title) {
            L.marker(coords, { icon: seaLakeIceIcon }).addTo(map)
                .bindPopup(`<strong>${title}</strong>`);
        }

        // Función para agregar un marcador de volcán al mapa con el icono personalizado
        function addVolcanoMarker(coords, title) {
            L.marker(coords, { icon: volcanoIcon }).addTo(map)
                .bindPopup(`<strong>${title}</strong>`);
        }

        // Función para agregar un marcador de tormenta severa al mapa con el icono personalizado
        function addStormMarker(coords, title) {
            L.marker(coords, { icon: stormIcon }).addTo(map)
                .bindPopup(`<strong>${title}</strong>`);
        }

        // Solicitud a la API de EONET para obtener eventos de incendios, glaciares, volcanes y tormentas severas
        fetch('https://eonet.gsfc.nasa.gov/api/v3/events')
            .then(response => response.json())
            .then(data => {
                const events = data.events;

                // Filtra los eventos que son incendios forestales (Wildfires)
                const wildfires = events.filter(event => event.categories.some(category => category.title === "Wildfires"));

                // Filtra los eventos que son de tipo Sea and Lake Ice
                const seaLakeIceEvents = events.filter(event => event.categories.some(category => category.title === "Sea and Lake Ice"));

                // Filtra los eventos que son de tipo volcanes
                const volcanoEvents = events.filter(event => event.categories.some(category => category.title === "Volcanoes"));

                // Filtra los eventos que son tormentas severas (Severe Storms)
                const stormEvents = events.filter(event => event.categories.some(category => category.title === "Severe Storms"));

                // Corrigiendo selección de botones
                const botonIncendios = document.getElementById('primero');
                const botonIcebergs = document.getElementById('segundo');
                const botonTormentas = document.getElementById('tercero');

                botonIncendios.addEventListener('click', () => {
                    console.log('Buscando incendios');
                    if (wildfires.length > 0) {
                        wildfires.forEach(event => {
                            const coords = event.geometry[0].coordinates;
                            const latLng = [coords[1], coords[0]]; // Latitud y longitud
                            const title = event.title;

                            // Agrega el marcador del incendio al mapa con el icono personalizado
                            addWildfireMarker(latLng, title);
                        });
                    } else {
                        console.log("No se encontraron incendios en los datos de EONET.");
                    }
                });

                // Asegúrate de agregar los otros botones también, por ejemplo:
                botonIcebergs.addEventListener('click', () => {
                    console.log('Buscando eventos de Sea and Lake Ice');
                    if (seaLakeIceEvents.length > 0) {
                        seaLakeIceEvents.forEach(event => {
                            const coords = event.geometry[0].coordinates;
                            const latLng = [coords[1], coords[0]]; // Latitud y longitud
                            const title = event.title;
                            addSeaLakeIceMarker(latLng, title);
                        });
                    } else {
                        console.log("No se encontraron eventos de Sea and Lake Ice en los datos de EONET.");
                    }
                });

                botonTormentas.addEventListener('click', () => {
                    console.log('Buscando tormentas severas');
                    if (stormEvents.length > 0) {
                        stormEvents.forEach(event => {
                            const coords = event.geometry[0].coordinates;
                            const latLng = [coords[1], coords[0]]; // Latitud y longitud
                            const title = event.title;
                            addStormMarker(latLng, title);
                        });
                    } else {
                        console.log("No se encontraron tormentas severas en los datos de EONET.");
                    }
                });
            })
            .catch(error => {
                console.error('Error al obtener los eventos de EONET:', error);
            });
    </script>
</body>
</html>
